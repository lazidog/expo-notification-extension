import { type ConfigPlugin, withInfoPlist } from "@expo/config-plugins";

// Add remote notification permission in Background Modes capability
const withRemoteNotificationsPermissions: ConfigPlugin = (config) => {
  const BACKGROUND_MODE_KEYS = ["remote-notification"];
  return withInfoPlist(config, (newConfig) => {
    if (!Array.isArray(newConfig.modResults.UIBackgroundModes)) {
      newConfig.modResults.UIBackgroundModes = [];
    }
    for (const key of BACKGROUND_MODE_KEYS) {
      if (!newConfig.modResults.UIBackgroundModes.includes(key)) {
        newConfig.modResults.UIBackgroundModes.push(key);
      }
    }

    return newConfig;
  });
};

export default withRemoteNotificationsPermissions;
